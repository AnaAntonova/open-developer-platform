<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">
<script src="https://buttons.github.io/buttons.js"></script>

<title data-react-helmet="true">Continuous Delivery | Open Developer Platform</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Open Developer Platform"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:url" content="https://finos.github.io/open-developer-platform/docs/development-infrastructure/continuous-delivery">

<link data-react-helmet="true" rel="shortcut icon" href="/open-developer-platform/img/favicon/favicon-finos.ico">


<link rel="stylesheet" href="/open-developer-platform/styles.8bbaa031.css">


<link rel="preload" href="/open-developer-platform/styles.45527fed.js" as="script">

<link rel="preload" href="/open-developer-platform/runtime~main.a0bf2eda.js" as="script">

<link rel="preload" href="/open-developer-platform/main.25ffeb5a.js" as="script">

<link rel="preload" href="/open-developer-platform/1.15feeac7.js" as="script">

<link rel="preload" href="/open-developer-platform/2.892edfd7.js" as="script">

<link rel="preload" href="/open-developer-platform/29.1eef7160.js" as="script">

<link rel="preload" href="/open-developer-platform/0b1affe5.d9cf37b5.js" as="script">

<link rel="preload" href="/open-developer-platform/17896441.43754c62.js" as="script">

<link rel="preload" href="/open-developer-platform/20f294e3.d108d501.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/open-developer-platform/"><img class="navbar__logo" src="/open-developer-platform/img/favicon/favicon-finos.ico" alt="FINOS Logo"><strong class="navbar__title">Open Developer Platform</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/open-developer-platform/docs/docs-intro">Docs</a><a class="navbar__item navbar__link" href="/open-developer-platform/docs/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/open-developer-platform/docs/team">Team</a><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/finos/open-developer-platform">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/open-developer-platform/"><img class="navbar__logo" src="/open-developer-platform/img/favicon/favicon-finos.ico" alt="FINOS Logo"><strong class="navbar__title">Open Developer Platform</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/docs-intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/team">Team</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/finos/open-developer-platform">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/open-developer-platform/img/favicon/favicon-finos.ico" alt="FINOS Logo"><strong>Open Developer Platform</strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/docs-intro">What is ODP</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/project-collaboration">Project collaboration</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development Infrastructure</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Continuous Integration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/continuous-integration/intro">Continuous Integration</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/continuous-integration/clojure">Clojure</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/continuous-integration/csharp">C#</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/continuous-integration/java">Java</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/continuous-integration/javascript">Javascript</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/continuous-integration/python">Python</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Code Validations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/code-validation/intro">Code Validation</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/code-validation/bithound">Bithound</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/code-validation/codeclimate">Code Climate</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/code-validation/coverityscan">Coverity Scan</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/code-validation/nodesecurity">Node Security</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/code-validation/sonarcloud">Sonar Cloud</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/code-validation/whitesource">Whitesource</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/development-infrastructure/project-documentation">Project Documentation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/open-developer-platform/docs/development-infrastructure/continuous-delivery">Continuous Delivery</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About ODP</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/team">Project Team</a></li><li class="menu__list-item"><a class="menu__link" href="/open-developer-platform/docs/roadmap">Roadmap</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Continuous Delivery</h1></header><div class="markdown"><p>Continuous Delivery (CD - read the <a href="https://martinfowler.com/bliki/ContinuousDelivery.html">definition given by Martin Fowler</a>) allows project leads and committers to configure automated processes to build and deploy their software. FINOS provides a <a href="#openshift-console">dedicated OpenShift Online instance</a> that can be used for this purpose.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="openshift-console"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#openshift-console" title="Direct link to heading">#</a>Openshift Console</h2><p>The Open Developer Platform provides access to a FINOS <a href="https://www.openshift.com/products/container-platform/">OpenShift Container Platform</a> instance (also called FINOS OpenShift Console), the leading enterprise Kubernetes distribution, so that developers can try out integrations with other containers, build and test containerised architectures and enable continuously deployed code build pipelines.</p><p>Access is granted (free of charge) to all FINOS project teams (see below); in this page we guide contributors to request access, understand the OpenShift FINOS setup and execute the first tests.</p><img alt="openshift-console" src="/open-developer-platform/img/vendors/openshift-console.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="how-to-get-access"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-to-get-access" title="Direct link to heading">#</a>How to get access</h2><p>In order to access the FINOS OpenShift Console, it is necessary to comply with the following requirements:</p><ol><li>You must be part of a <a href="/open-developer-platform/project-collaboration#teams">FINOS project team</a></li><li>You must have an account on developers.redhat.com; you can also sign up with your GitHub credentials</li></ol><p>To request access, send an email to help@finos.org, with the following info:
1. Name, surname and company
2. Corporate email address
3. GitHub ID
4. Red Hat Login ID (when logged into Red Hat Developers portal, go to the account page)
5. FINOS Project team you are part of</p><p>The FINOS Infra team will create a project for your project, grant permissions to your Red Hat user and notify you via email the link to access the FINOS OpenShift Console.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="travis-ci-to-openshift-integration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#travis-ci-to-openshift-integration" title="Direct link to heading">#</a>Travis CI to OpenShift integration</h2><p>Travis CI <a href="https://docs.travis-ci.com/user/customizing-the-build/">configuration</a> can be extended trigger the OpenShift image build and deployment; to make configuration easier, the Foundation provides a script called <a href="https://github.com/symphonyoss/contrib-toolbox/blob/master/scripts/oc-deploy.sh"><code>oc-deploy.sh</code></a> that can be executed as <code>after_success</code> script and triggers a containerised deployment, using the OpenShift CLI tool; with a simple bash line, the following operations are performed:</p><ol><li>Install OpenShift CLI (oc) in the current environment (see <code>OC_VERSION</code> and <code>OC_RELEASE</code>)</li><li>Logs into OpenShift Online (see <code>OC_ENDPOINT</code>) and select the right OpenShift project (see <code>OC_PROJECT</code>)</li><li>Deletes - if <code>OC_DELETE_LABEL</code> is defined - all OpenShift resources marked with the specified <code>key=value</code> label</li><li>Processes - if <code>OC_TEMPLATE</code> file exists and is valid - and creates all OpenShift resources defined within; template parameter values can be passed using the <code>OC_TEMPLATE_PROCESS_ARGS</code> configuration variable</li><li>Triggers the build of an OpenShift image, identified by the <code>BOT_NAME</code> configuration variable, uploading the application binary as ZIP archive (see <code>OC_BINARY_ARCHIVE</code>) or a folder (see <code>OC_BINARY_FOLDER</code>) that have been generated by the project build; the folder is preferred over the archive binary distribution, as it&#x27;s less likely to cause network timeouts during the upload</li></ol><p>Below is the Travis configuration.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">after_success: curl -s https://raw.githubusercontent.com/symphonyoss/contrib-toolbox/master/scripts/oc-deploy.sh | bash</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="configuration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration" title="Direct link to heading">#</a>Configuration</h2><p>The oc-deploy.sh script requires some mandatory environment variables to be defined before executing the script; the mandatory ones are:</p><ul><li><code>OC_TOKEN</code> - The Openshift Online token</li><li><code>BOT_NAME</code> - the name of the BuildConfig registered in OpenShift, which is used to start the OpenShift build</li><li><code>OC_TEMPLATE</code> - Path of an OpenShift template to (oc) process and create, if existent; defaults to .openshift-template.yaml</li><li><code>OC_BINARY_ARCHIVE</code> or <code>OC_BINARY_FOLDER</code> - Relative path to the ZIP file (or folder) to upload to the container as source</li><li>Any other environment variable containing template parameters, see <code>OC_TEMPLATE_PROCESS_ARGS</code> below</li></ul><p>Please review the default values of the following variables:</p><ul><li><code>OC_DELETE_LABEL</code> - Used to delete a group of resources with the same label; If set, the script will invoke oc delete all -l &lt;OC_DELETE_LABEL&gt;; example: <code>OC_DELETE_LABEL=&quot;app=mybot&quot;</code></li><li><code>OC_TEMPLATE_PROCESS_ARGS</code> - Comma-separated list of environment variables to pass to the OC template; defaults to null; example <code>OC_TEMPLATE_PROCESS_ARGS=&quot;BOT_NAME,S2I_IMAGE&quot;</code></li><li><code>OC_VERSION</code> - OpenShift CLI version; defaults to <code>1.5.1</code></li><li><code>OC_RELEASE</code> - OpenShift CLI release; defaults to <code>7b451fc-linux-64bit</code></li><li><code>OC_ENDPOINT</code> - OpenShift server endpoint; defaults to <code>https://api.starter-us-east-1.openshift.com</code></li><li><code>OC_PROJECT_NAME</code> - The Openshift Online project to use; default is <code>ssf-dev</code>, no changes needed</li><li><code>OC_ENDPOINT</code> - OpenShift server endpoint; defaults to <code>https://api.pro-us-east-1.openshift.com</code> , no changes needed</li><li><code>SKIP_OC_INSTALL</code> - Skips the OpenShift CLI (oc) installation; defaults to false; useful for local <code>oc-deploy.sh</code> test runs</li></ul><p>The example below shows a complete <code>.travis.yml</code> configuration.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">env:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  global:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - BOT_NAME=&quot;mybot&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - OC_DELETE_LABEL=&quot;app=mybot&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - SYMPHONY_POD_HOST=&quot;foundation-dev.symphony.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - SYMPHONY_API_HOST=&quot;foundation-dev-api.symphony.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - OC_BINARY_FOLDER=&quot;vote-bot-service/target/oc&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - OC_TEMPLATE_PROCESS_ARGS=&quot;BOT_NAME,SYMPHONY_POD_HOST,SYMPHONY_API_HOST&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">after_success: curl -s https://raw.githubusercontent.com/symphonyoss/contrib-toolbox/master/scripts/oc-deploy.sh | bash</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="project-setup"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#project-setup" title="Direct link to heading">#</a>Project setup</h3><p>In order to configure Continuous Delivery, the project must meet few requirements and some configuration must be defined.</p><ol><li>Get familiar with <a href="https://finosfoundation.atlassian.net/wiki/spaces/FDX/pages/75727050/Continuous+Delivery#ContinuousDelivery-glossary">OpenShift concepts</a>; keep in mind that most of them are inherited by Kubernetes, which is the orchestration engine used by OpenShift.</li><li><strong>Memory (size) and CPU (number) requirements must be known</strong> upfront</li><li>The <a href="https://docs.openshift.com/container-platform/3.3/dev_guide/deployments/deployment_strategies.html"><strong>deployment strategy</strong></a> <strong>must be known</strong> upfront; default is RollingDeployment, which spins up a new container in parallel to the existing one, switches traffic when the new one is ready and finally kills the existing one.</li><li>Collect all passwords and secrets that are needed by the applications to run; the Foundation Staff will register these entries as secrets in OpenShift and deliver secret key references</li><li>The build process MUST generate a folder that:
a. <strong>MUST contain all the artifacts</strong> to run the application; for Maven builds, the assembly plugin can be used
b. <strong>MUST contain a (Unix) run script</strong>; for Maven builds, the <a href="http://www.mojohaus.org/appassembler/appassembler-maven-plugin/">appassember plugin</a> can generate it
c. <strong>MUST NOT contain any password</strong>, secret or sensitive data (like emails, names, addresses, etc) in clear text; <a href="https://docs.openshift.com/container-platform/latest/dev_guide/secrets.html#dev-guide-secrets-using-secrets">OpenShift secrets</a> provide a safe way to manage them</li><li>Follow the instructions below to define an <a href="https://docs.openshift.org/latest/architecture/core_concepts/templates.html">OpenShift template</a> called <code>.openshift-template.yaml</code>, in the root folder of the GitHub repository</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="template-definition"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#template-definition" title="Direct link to heading">#</a>Template definition</h2><p>Below is described, section by section, an OpenShift template that defines</p><ol><li>The Docker image build process for the given app</li><li>The image stream that triggers a deployment configuration when an image is created</li><li>The deployment configuration that defines - among other things - the containers to run and its configuration</li></ol><p>You will notice that all resources configured below define an app label with the same value, which allows to run commandline commands across all resources with the same label, for example <code>oc delete all -l app=mybot</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="template-name-and-parameters"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#template-name-and-parameters" title="Direct link to heading">#</a>Template name and parameters</h3><p>This is the header of the file, which defines the template name mybot-template and a list of parameters, like BOT_NAME; parameters must be exported as environment variables before invoking <code>oc-deploy.sh</code> (see above); from the objects: line below, the Openshift configuration resources are defined.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Template</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: mybot-template</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">parameters:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- name: BOT_NAME</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description: The Bot name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  displayName: Bot Name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  required: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value: &quot;mybot&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- name: SEND_EMAIL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  description: Whether the bot should send emails or not; defaults to true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  displayName: Send Email?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  required: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value: &quot;true&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">objects:</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="images-and-streams"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#images-and-streams" title="Direct link to heading">#</a>Images and streams</h3><p>The OpenShift image creation process is carried by a container called deployer and decribed by the BuildConfig resource, which takes as parameters:</p><ul><li>a <code>sourceStrategy</code>, which identifies the container image used to build the deployer container and points to the <code>ImageStream</code> with name <code>s2i-java</code></li><li>the output image name and tag, which points to the <code>ImageStream</code> with name <code>${BOT_NAME}</code></li></ul><p>See the example below.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: ImageStream</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: s2i-java</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dockerImageRepository: &quot;docker.io/jorgemoralespou/s2i-java&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: ImageStream</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec: {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  status:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dockerImageRepository: &quot;&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: BuildConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    output:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      to:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        kind: ImageStreamTag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        name: ${BOT_NAME}:latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    postCommit: {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    resources: {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    runPolicy: Serial</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    source:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type: Binary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      binary:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    strategy:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type: Source</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      sourceStrategy:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          kind: ImageStreamTag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: s2i-java:latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    triggers: {}</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="deployment-configuration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#deployment-configuration" title="Direct link to heading">#</a>Deployment configuration</h3><p>The DeploymentConfig resource defines:</p><ol><li>The deployment strategy, defaults to <code>Rolling</code></li><li>The container configuration
a. The image to use to create the container; this must match with the ImageStream output defined above
b. TCP/UDP ports to expose; in this case port <code>8080</code> is open at container level
c. The <a href="https://docs.openshift.org/latest/dev_guide/application_health.html"><code>readinessProbe</code></a> detects if the container is unhealthy
d. Container environment variables can be defined in clear text (ie <code>LOG4J_FILE</code>) or loaded from a secret key reference; secrects are managed by the Foundation Staff and are normally used to manage credentials used to access the external APIs.</li><li>The deployment configuration <code>trigger</code>, pointing to the <code>latest</code> tag of an image called <code>${BOT_NAME}</code></li></ol><p>See the example below.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: DeploymentConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    replicas: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    selector:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      deploymentconfig: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    strategy:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      rollingParams:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        intervalSeconds: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        maxSurge: 25%</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        maxUnavailable: 25%</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        timeoutSeconds: 600</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        updatePeriodSeconds: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type: Rolling</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    template:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          deploymentconfig: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        containers:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - image: ${BOT_NAME}:latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          imagePullPolicy: Always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          - containerPort: 8080</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            protocol: TCP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          readinessProbe:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            httpGet:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              path: &quot;/healthcheck&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              port: 8080</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            initialDelaySeconds: 15</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            timeoutSeconds: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          env:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          - name: LOG4J_FILE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            value: &quot;/opt/openshift/log4j.properties&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          - name: TRUSTSTORE_PASSWORD</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            valueFrom:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              secretKeyRef:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                name: ${BOT_NAME}.certs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                key: truststore.password</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    triggers:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - type: ConfigChange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - imageChangeParams:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        automatic: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        containerNames:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        - ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          kind: ImageStreamTag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          name: ${BOT_NAME}:latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      type: ImageChange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  status: {}</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="service-definition"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#service-definition" title="Direct link to heading">#</a>Service definition</h3><p>In order to access the container port, it is necessary to define</p><ol><li>a Service that acts as load-balancer across all containers with app=${BOT_NAME} label</li><li>a Route that registers to the OpenShift DNS and points to the Service</li></ol><p>See the example below.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: Service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    annotations:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      openshift.io/generated-by: OpenShiftNewApp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - name: healthcheck-tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      port: 8080</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      protocol: TCP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      targetPort: 8080</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    selector:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      deploymentconfig: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sessionAffinity: None</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    type: ClusterIP</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  status:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    loadBalancer: {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: Route</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    name: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      app: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    to:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      kind: Service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name: ${BOT_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      weight: 100</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    port:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      targetPort: healthcheck-tcp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    wildcardPolicy: None</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="useful-commands"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#useful-commands" title="Direct link to heading">#</a>Useful commands</h2><p>Below are some commands we found useful while setting up our Symphony bots on OpenShift Online, using the <a href="https://docs.openshift.com/container-platform/3.9/cli_reference/get_started_cli.html">OpenShift CLI (<code>oc</code>)</a>.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-undefined codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Login on FINOS OpenShift - copy from https://console.pro-us-east-1.openshift.com/console/command-line</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export OC_TOKEN=...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc login https://api.pro-us-east-1.openshift.com --token=$OC_TOKEN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># List of projects</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc projects</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Select a specific project; all next commands will refer to that project</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc project my_bot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Show list of services, builds, pods and deployments for the current project</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc status</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Import an image from Docker Hub</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc import-image maoo/s2i-java-binary --all --confirm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Processes an OpenShift template definition and passes parameter values</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc process -f bot_template.yaml -p BOT_NAME=my_botname | oc create -f -</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Start an OpenShift build, passing an archive or a folder</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc start-build my_botname --from-archive=./target/archive.zip --wait=true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc start-build my_botname --from-dir=./target/my_botname --wait=true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Deletes all resources with label &#x27;app&#x27; equals to &#x27;my_botname&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc delete all -l app=my_botname</span></div></code></pre></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/finos/open-developer-platform/edit/master/website/../docs/development-infrastructure/continuous-delivery.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/open-developer-platform/docs/development-infrastructure/project-documentation"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Project Documentation</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/open-developer-platform/docs/team"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Project Team »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#openshift-console" class="contents__link">Openshift Console</a></li><li><a href="#how-to-get-access" class="contents__link">How to get access</a></li><li><a href="#travis-ci-to-openshift-integration" class="contents__link">Travis CI to OpenShift integration</a></li><li><a href="#configuration" class="contents__link">Configuration</a><ul><li><a href="#project-setup" class="contents__link">Project setup</a></li></ul></li><li><a href="#template-definition" class="contents__link">Template definition</a><ul><li><a href="#template-name-and-parameters" class="contents__link">Template name and parameters</a></li><li><a href="#images-and-streams" class="contents__link">Images and streams</a></li><li><a href="#deployment-configuration" class="contents__link">Deployment configuration</a></li><li><a href="#service-definition" class="contents__link">Service definition</a></li></ul></li><li><a href="#useful-commands" class="contents__link">Useful commands</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Comminity</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" to="https://finosfoundation.atlassian.net/wiki/spaces/OSR" href="https://finosfoundation.atlassian.net/wiki/spaces/OSR">OSR Program</a></li><li class="footer__item"><a class="footer__link-item" to="http://finos.github.io" href="http://finos.github.io">FINOS Project Catalogue</a></li><li class="footer__item"><a class="footer__link-item" to="https://finosfoundation.atlassian.net/wiki/spaces/FINOS/pages/80642059/Community+Handbook" href="https://finosfoundation.atlassian.net/wiki/spaces/FINOS/pages/80642059/Community+Handbook">FINOS Community Handbook</a></li><li class="footer__item"><a class="footer__link-item" to="https://finosfoundation.atlassian.net/wiki/spaces/FINOS/pages/75530783/Community+Governance" href="https://finosfoundation.atlassian.net/wiki/spaces/FINOS/pages/75530783/Community+Governance">FINOS Community Governance</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://finos.org" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="FINOS Logo" src="/open-developer-platform/img/favicon/favicon-finos.ico"></a></div><div>Copyright © 2018 - Open Developer Platform - FINOS - The Fintech Open Source Foundation</div></div></div></footer>
</div>

<script src="/open-developer-platform/styles.45527fed.js"></script>

<script src="/open-developer-platform/runtime~main.a0bf2eda.js"></script>

<script src="/open-developer-platform/main.25ffeb5a.js"></script>

<script src="/open-developer-platform/1.15feeac7.js"></script>

<script src="/open-developer-platform/2.892edfd7.js"></script>

<script src="/open-developer-platform/29.1eef7160.js"></script>

<script src="/open-developer-platform/0b1affe5.d9cf37b5.js"></script>

<script src="/open-developer-platform/17896441.43754c62.js"></script>

<script src="/open-developer-platform/20f294e3.d108d501.js"></script>


</body>
</html>